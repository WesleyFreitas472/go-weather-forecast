language: go

branches:
  only:
    - master

before_script:
  - go vet ./...

install:
  - export GOPATH="${TRAVIS_BUILD_DIR}/Godeps/_workspace:$GOPATH"
  - export PATH="${TRAVIS_BUILD_DIR}/Godeps/_workspace/bin:$PATH"

script:
  - GOOS_VAL=$(shell go env GOOS) GOARCH_VAL=$(shell go env GOARCH) go build -v -a -installsuffix cgo -o ./build/weather-forecast cmd/*.go
  - docker build . -t weather-forecast:master
  - docker login $(DOCKER_USERNAME) -p $(DOCKER_PASSWORD)
  - docker push wesleyfreitas472/weather-forecast:master
